<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Losowanie Osoby z Firebase</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    select {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 100%;
      max-width: 300px; /* Dostosuj szerokość do swoich potrzeb */
    }
    button {
      margin: 20px;
      padding: 10px 20px;
    }

    /* Dodaj styl dla obrazka maszyny */
    #maszyna {
      display: none; /* Ukryj na początku */
    }
    #wylosowaneZdjecie {
      display: none; /* Ukryj na początku */
      max-width: 300px; /* Dostosuj szerokość zdjęcia */
      margin-top: 20px;
    }
    #losujBtn {
      background-color: #DC3545;
      display: none;
    }
    #dalejBtn {
      background-color: #28A745;
    }
  </style>
</head>
<body>
<h1>Losowanie Osoby</h1>
<p id="selectSelf">Wybierz siebie</p>
<select id="osobySelect"></select>
<button id="dalejBtn">Dalej</button>

<!-- Dodaj obrazek animowanej maszyny (GIF) -->
<img src="https://www.us-lotterypowerball.com/images/play_machine.gif" alt="Maszyna" id="maszyna">

<button id="losujBtn">Losuj osobę</button>
<p id="wynik"></p>

<img src="https://media.istockphoto.com/id/1001563468/photo/headshot-of-handsome-surprised-black-man-looking-at-the-camera-astonished-with-big-sale.jpg?s=612x612&w=0&k=20&c=A4NX72cahXi5lxXiNL03JwDh2JJEwsfhafmJqlwx504=" alt="Wylosowane Zdjęcie" id="wylosowaneZdjecie">

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
  // Konfiguracja Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyC9Kaqtzn5veYgNfilJVjtVvcQ-FDuxMS0",
    authDomain: "losowaniepulavue.firebaseapp.com",
    projectId: "losowaniepulavue",
    storageBucket: "losowaniepulavue.appspot.com",
    messagingSenderId: "336274214313",
    appId: "1:336274214313:web:f0a1f9838b952fe62bc8b8",
    measurementId: "G-4D188Z7KZ6"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const losujBtn = document.getElementById('losujBtn');
  const wynik = document.getElementById('wynik');
  const maszyna = document.getElementById('maszyna');
  const wylosowaneZdjecie = document.getElementById('wylosowaneZdjecie');
  const osobySelect = document.getElementById('osobySelect');
  const dalejBtn = document.getElementById('dalejBtn');
  const selfText = document.getElementById('selectSelf');

  let wybranaOsoba = "";

  osobySelect.addEventListener('change', (event) => {
    wybranaOsoba = event.target.value;
    dalejBtn.style.display = 'block';
  });

  db.collection("osobylosujace").get().then((querySnapshot) => {
    querySnapshot.forEach((doc) => {
      const option = document.createElement('option');
      option.value = doc.data().name;
      option.text = doc.data().name;
      osobySelect.appendChild(option);
    });
  });

  dalejBtn.addEventListener('click', () =>  {
    dalejBtn.style.display = 'none';
    osobySelect.style.display = 'none';
    losujBtn.style.display = 'block';
    selfText.style.display = 'block';
  })


  losujBtn.addEventListener('click', () => {
    losujBtn.disabled = true; // Wyłącz przycisk podczas losowania
    wynik.innerText = 'Losowanie...';
    maszyna.style.display = 'block'; // Wyświetl animację maszyny

    // Symulacja kręcenia maszyny przez 3 sekundy (możesz dostosować czas)
    setTimeout(() => {
      db.collection("osobydolosowania").get().then((querySnapshot) => {
        const osoby = [];
        querySnapshot.forEach((doc) => {
          osoby.push(doc.data().name);
        });

        if (osoby.length > 0) {
          let wylosowanaOsoba = "";
          do {
            wylosowanaOsoba = osoby[Math.floor(Math.random() * osoby.length)];
          } while (wylosowanaOsoba === wybranaOsoba); // Sprawdź, czy wylosowana osoba jest różna od wybranej

          wynik.innerText = 'Wylosowana osoba: ' + wylosowanaOsoba;

          // Opcjonalnie: Usuń wylosowaną osobę z bazy danych
          usunOsobeZBazy(wybranaOsoba, 1);
          usunOsobeZBazy(wylosowanaOsoba, 2);

          // Ukryj przycisk, aby nie można było ponownie losować
          losujBtn.style.display = 'none';
          wylosowaneZdjecie.style.display = 'block';
        } else {
          wynik.innerText = 'Brak osób do losowania.';
        }

        maszyna.style.display = 'none'; // Ukryj animację maszyny
      });
    }, 8000); // Czas trwania animacji (3 sekundy)
  });

  function usunOsobeZBazy(osoba, type) {
    if (type === 1) {
      db.collection("osobylosujace").where("name", "==", osoba).get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          db.collection("osobylosujace").doc(doc.id).delete().then(() => {
            console.log("Osoba usunięta: ", osoba);
          });
        });
      });
    } else if (type === 2) {
      db.collection("osobydolosowania").where("name", "==", osoba).get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          db.collection("osobydolosowania").doc(doc.id).delete().then(() => {
            console.log("Osoba usunięta: ", osoba);
          });
        });
      });
    }

  }
</script>
</body>
</html>
